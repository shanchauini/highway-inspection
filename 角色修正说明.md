# 角色修正说明

## 修正内容

系统角色已从三个角色简化为两个角色：

### 修正前
- ❌ 管理员 (admin)
- ❌ 空域管理员 (airspace_manager) 
- ❌ 操作员 (operator)

### 修正后
- ✅ 管理员 (admin)
- ✅ 操作员 (operator)

## 权限调整

### 管理员 (admin)
**拥有所有权限**，包括：
- ✅ 用户管理（增删改查）
- ✅ 空域管理（增删改查）
- ✅ 飞行申请审批
- ✅ 放飞审批
- ✅ 告警处理
- ✅ 设备管理
- ✅ 删除敏感数据
- ✅ 查看所有数据

### 操作员 (operator)
**基础操作权限**，包括：
- ✅ 创建飞行申请
- ✅ 查看自己的申请
- ✅ 申请放飞
- ✅ 视频上传和查看
- ✅ 查看空域（只读）
- ✅ 告警确认
- ❌ 无审批权限
- ❌ 无空域管理权限
- ❌ 无删除敏感数据权限

## 已修改的文件清单

### 前端文件（7个）
1. ✅ `src/stores/user.ts` - 用户类型定义
2. ✅ `README.md` - 默认账号说明
3. ✅ `USER_MANAGEMENT.md` - 用户管理文档
4. ✅ `PROJECT_README.md` - 项目说明
5. ✅ `DEPLOYMENT_GUIDE.md` - 部署指南
6. ✅ `BACKEND_QUICKSTART.md` - 后端快速开始
7. ✅ `API_REFERENCE.md` - API参考文档

### 后端文件
- ✅ `app/models/user.py` - **已正确**，无需修改（已定义为 `Enum('operator', 'admin')`）

## 数据库调整

### User 模型
```python
role = db.Column(db.Enum('operator', 'admin'), nullable=False)
```

后端模型已经正确，无需修改。

## 默认测试账号

修正后的测试账号：
- **管理员**: `admin` / `admin123`
- **操作员**: `operator1` / `operator123`

~~已删除~~: `manager1` / `manager123` (空域管理员账号)

## 业务流程调整

### 飞行申请流程
1. 操作员创建申请 → 填写表单 → 保存草稿/提交
2. **管理员**收到申请 → 审批 → 批准/驳回 *(原：空域管理员)*
3. 操作员查看结果 → 申请放飞
4. **管理员**批准放飞 → 系统校验 → 准许/暂缓 *(原：空域管理员)*

### 空域管理流程
1. **管理员**创建空域 → 设置坐标和属性 → 保存 *(原：空域管理员)*
2. 系统在地图上绘制多边形 → 显示状态
3. 用户查看空域 → 搜索筛选
4. **管理员**修改状态 → 记录历史 → 更新地图 *(原：空域管理员)*

## 注意事项

1. **数据库迁移**：如果已有数据库，需要将 `airspace_manager` 角色的用户迁移为 `admin` 角色
2. **前端路由守卫**：检查前端路由权限配置，确保没有引用 `airspace_manager`
3. **API权限验证**：后端已正确实现，只有 `admin` 和 `operator` 两个角色
4. **测试数据**：更新测试数据初始化脚本，删除空域管理员相关数据

## 验证清单

- [x] 前端 TypeScript 类型定义已更新
- [x] 前端文档已更新
- [x] 后端模型已确认正确
- [x] API 文档已更新
- [x] 默认账号说明已更新
- [x] 权限说明已更新
- [x] 业务流程说明已更新

## 后续工作

如需进一步调整，请检查：
1. 前端路由配置文件（`router/index.ts`）
2. 前端权限控制逻辑
3. 数据库初始化脚本（`init_db.py`）
4. 测试脚本中的角色引用

---

**修正完成日期**: 2025-11-15  
**修正人**: AI Assistant
