# ç™»å½•åŠŸèƒ½æµ‹è¯•æŒ‡å—

## ğŸ” å‘ç°çš„é—®é¢˜

### é—®é¢˜1ï¼šå‰ç«¯æ²¡æœ‰è°ƒç”¨åç«¯API âŒ
**åŸå› ï¼š** `Login.vue` ä¸­ä½¿ç”¨çš„æ˜¯Mockæ•°æ®ï¼Œç›´æ¥åœ¨å‰ç«¯æ¨¡æ‹Ÿç™»å½•
```typescript
// é”™è¯¯çš„ä»£ç ï¼ˆå·²ä¿®å¤ï¼‰
setTimeout(() => {
  userStore.login(
    {
      id: 'u1',
      username: form.username,
      role: form.role,
      name: form.username
    },
    'mock-token'  // å‡token
  )
  router.push('/map')
}, 600)
```

**åæœï¼š** ä»»ä½•ç”¨æˆ·åå¯†ç éƒ½èƒ½ç™»å½•æˆåŠŸ

### é—®é¢˜2ï¼šAPIæ¨¡å—ç¼ºå°‘è®¤è¯æ¥å£ âŒ
**åŸå› ï¼š** `src/api/modules.ts` ä¸­æ²¡æœ‰å®šä¹‰ç™»å½•ã€æ³¨å†Œç­‰è®¤è¯æ¥å£

## âœ… å·²ä¿®å¤çš„å†…å®¹

### 1. æ·»åŠ è®¤è¯APIæ¥å£
åœ¨ `src/api/modules.ts` ä¸­æ·»åŠ ï¼š
```typescript
export const authApi = {
  // ç”¨æˆ·ç™»å½•
  login: (username: string, password: string) => {
    return api.post('/auth/login', { username, password })
  },
  
  // ç”¨æˆ·æ³¨å†Œ
  register: (username: string, password: string, role?: string) => {
    return api.post('/auth/register', { username, password, role })
  },
  
  // è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
  getCurrentUser: () => {
    return api.get('/auth/current')
  },
  
  // ç™»å‡º
  logout: () => {
    return api.post('/auth/logout')
  }
}
```

### 2. ä¿®å¤Login.vueè°ƒç”¨çœŸå®åç«¯
```typescript
const onSubmit = async () => {
  try {
    await formRef.value?.validate()
    loading.value = true
    
    // è°ƒç”¨åç«¯ç™»å½•API
    const response = await authApi.login(form.username, form.password)
    
    if (response.code === 200 && response.data) {
      const { user, access_token } = response.data
      
      // ä¿å­˜ç”¨æˆ·ä¿¡æ¯å’Œtoken
      userStore.login(
        {
          id: user.id.toString(),
          username: user.username,
          role: user.role,
          name: user.username
        },
        access_token
      )
      
      ElMessage.success('ç™»å½•æˆåŠŸ')
      router.push('/map')
    }
  } catch (error) {
    ElMessage.error('ç™»å½•å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç”¨æˆ·åå’Œå¯†ç ')
  }
}
```

### 3. ç§»é™¤ä¸å¿…è¦çš„è§’è‰²é€‰æ‹©
- ç§»é™¤äº†ç™»å½•è¡¨å•ä¸­çš„"è§’è‰²"é€‰æ‹©ä¸‹æ‹‰æ¡†
- è§’è‰²ä¿¡æ¯ç”±åç«¯è¿”å›ï¼Œä¸éœ€è¦å‰ç«¯é€‰æ‹©

## ğŸ§ª æµ‹è¯•æ­¥éª¤

### æ­¥éª¤1ï¼šå¯åŠ¨åç«¯
```bash
cd highway-inspection-backend
python run.py
```

### æ­¥éª¤2ï¼šå¯åŠ¨å‰ç«¯ï¼ˆé‡è¦ï¼šéœ€è¦é‡æ–°å¯åŠ¨ï¼‰
```bash
cd highway-inspection-frontend

# å¦‚æœæ­£åœ¨è¿è¡Œï¼Œå…ˆåœæ­¢ï¼ˆCtrl+Cï¼‰
# ç„¶åé‡æ–°å¯åŠ¨
npm run dev
```

### æ­¥éª¤3ï¼šæµ‹è¯•æ­£ç¡®çš„ç™»å½•
1. è®¿é—® `http://localhost:5173`
2. è¾“å…¥æ­£ç¡®çš„ç”¨æˆ·åå¯†ç ï¼š
   - ç”¨æˆ·åï¼š`operator1`
   - å¯†ç ï¼š`op123`
3. ç‚¹å‡»"ç™»å½•"
4. **é¢„æœŸç»“æœï¼š**
   - âœ… æ˜¾ç¤º"ç™»å½•æˆåŠŸ"æç¤º
   - âœ… è·³è½¬åˆ°åœ°å›¾é¡µé¢
   - âœ… å³ä¸Šè§’æ˜¾ç¤ºç”¨æˆ·å
   - âœ… Networké¢æ¿æ˜¾ç¤ºè¯·æ±‚åˆ°åç«¯API

### æ­¥éª¤4ï¼šæµ‹è¯•é”™è¯¯çš„ç™»å½•
1. è¾“å…¥ä¸å­˜åœ¨çš„ç”¨æˆ·åå¯†ç ï¼š
   - ç”¨æˆ·åï¼š`wronguser`
   - å¯†ç ï¼š`wrongpass`
2. ç‚¹å‡»"ç™»å½•"
3. **é¢„æœŸç»“æœï¼š**
   - âœ… æ˜¾ç¤º"ç™»å½•å¤±è´¥"é”™è¯¯æç¤º
   - âœ… åœç•™åœ¨ç™»å½•é¡µé¢
   - âœ… Networké¢æ¿æ˜¾ç¤º401é”™è¯¯

### æ­¥éª¤5ï¼šæµ‹è¯•å¯†ç é”™è¯¯
1. è¾“å…¥æ­£ç¡®ç”¨æˆ·åï¼Œé”™è¯¯å¯†ç ï¼š
   - ç”¨æˆ·åï¼š`operator1`
   - å¯†ç ï¼š`wrongpassword`
2. ç‚¹å‡»"ç™»å½•"
3. **é¢„æœŸç»“æœï¼š**
   - âœ… æ˜¾ç¤º"ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯"
   - âœ… åœç•™åœ¨ç™»å½•é¡µé¢

## ğŸ” éªŒè¯æ–¹æ³•

### æ–¹æ³•1ï¼šæµè§ˆå™¨å¼€å‘è€…å·¥å…·
1. æ‰“å¼€ `http://localhost:5173`
2. æŒ‰ F12 æ‰“å¼€å¼€å‘è€…å·¥å…·
3. åˆ‡æ¢åˆ° **Network** æ ‡ç­¾
4. å°è¯•ç™»å½•
5. æŸ¥çœ‹è¯·æ±‚ï¼š
   ```
   è¯·æ±‚URL: http://localhost:3000/api/auth/login
   è¯·æ±‚æ–¹æ³•: POST
   è¯·æ±‚æ•°æ®: {"username":"operator1","password":"op123"}
   
   å“åº”çŠ¶æ€ç : 200 (æˆåŠŸ) æˆ– 401 (å¤±è´¥)
   å“åº”æ•°æ®: 
   {
     "code": 200,
     "message": "ç™»å½•æˆåŠŸ",
     "data": {
       "user": {...},
       "access_token": "eyJ..."
     }
   }
   ```

### æ–¹æ³•2ï¼šConsoleæ—¥å¿—
åœ¨æµè§ˆå™¨Consoleä¸­ä¼šçœ‹åˆ°ï¼š
- æˆåŠŸï¼š`ç™»å½•æˆåŠŸ`
- å¤±è´¥ï¼š`ç™»å½•å¤±è´¥: ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯`

### æ–¹æ³•3ï¼šLocalStorageæ£€æŸ¥
1. æ‰“å¼€å¼€å‘è€…å·¥å…·
2. åˆ‡æ¢åˆ° **Application** æ ‡ç­¾
3. å·¦ä¾§é€‰æ‹© **Local Storage** â†’ `http://localhost:5173`
4. æˆåŠŸç™»å½•ååº”è¯¥çœ‹åˆ°ï¼š
   - `token`: å®é™…çš„JWT tokenï¼ˆä»¥eyJå¼€å¤´ï¼‰
   - `user`: ç”¨æˆ·ä¿¡æ¯JSON

### æ–¹æ³•4ï¼šåç«¯æ—¥å¿—
åç«¯ç»ˆç«¯ä¼šæ˜¾ç¤ºï¼š
```
POST /api/auth/login - 200  (æˆåŠŸ)
POST /api/auth/login - 401  (å¤±è´¥)
```

## ğŸ“ æµ‹è¯•ç”¨ä¾‹

| æµ‹è¯•åœºæ™¯ | ç”¨æˆ·å | å¯†ç  | é¢„æœŸç»“æœ |
|---------|--------|------|---------|
| æ­£å¸¸ç™»å½•-æ“ä½œå‘˜ | operator1 | op123 | âœ… ç™»å½•æˆåŠŸ |
| æ­£å¸¸ç™»å½•-ç®¡ç†å‘˜ | admin | admin123 | âœ… ç™»å½•æˆåŠŸ |
| ç”¨æˆ·ä¸å­˜åœ¨ | notexist | any | âŒ ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯ |
| å¯†ç é”™è¯¯ | operator1 | wrong | âŒ ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯ |
| ç©ºç”¨æˆ·å | (ç©º) | op123 | âŒ è¯·è¾“å…¥ç”¨æˆ·å |
| ç©ºå¯†ç  | operator1 | (ç©º) | âŒ è¯·è¾“å…¥å¯†ç  |

## ğŸ”’ åç«¯éªŒè¯é€»è¾‘

### 1. æ•°æ®åº“æŸ¥è¯¢
```python
# auth_service.py
user = User.query.filter_by(username=username).first()
```

### 2. å¯†ç éªŒè¯
```python
if not user or not user.check_password(password):
    raise ValueError('ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯')
```

### 3. å¯†ç åŠ å¯†æ–¹å¼
```python
# user.py
from werkzeug.security import generate_password_hash, check_password_hash

def set_password(self, password):
    self.password = generate_password_hash(password)

def check_password(self, password):
    return check_password_hash(self.password, password)
```

## ğŸ¯ å®Œæ•´çš„ç™»å½•æµç¨‹

```
1. ç”¨æˆ·è¾“å…¥ç”¨æˆ·åå¯†ç 
   â†“
2. å‰ç«¯è°ƒç”¨ authApi.login()
   â†“
3. å‘é€POSTè¯·æ±‚åˆ° /api/auth/login
   â†“
4. åç«¯æ¥æ”¶è¯·æ±‚
   â†“
5. AuthService.login() éªŒè¯ç”¨æˆ·åå¯†ç 
   â†“
6. æ•°æ®åº“æŸ¥è¯¢ç”¨æˆ·
   â†“
7. æ£€æŸ¥å¯†ç å“ˆå¸Œå€¼
   â†“
8. ç”ŸæˆJWT token
   â†“
9. è¿”å›ç”¨æˆ·ä¿¡æ¯å’Œtoken
   â†“
10. å‰ç«¯ä¿å­˜åˆ° localStorage
   â†“
11. è·³è½¬åˆ°åœ°å›¾é¡µé¢
```

## ğŸš¨ å¸¸è§é—®é¢˜

### Q1: ç‚¹å‡»ç™»å½•åæ²¡æœ‰ååº”
**A:** æ£€æŸ¥ï¼š
1. å‰ç«¯æ˜¯å¦å·²é‡æ–°å¯åŠ¨ï¼ˆä¿®æ”¹ä»£ç åéœ€è¦é‡å¯ï¼‰
2. æµè§ˆå™¨Consoleæ˜¯å¦æœ‰é”™è¯¯
3. Networké¢æ¿æ˜¯å¦æœ‰è¯·æ±‚å‘å‡º

### Q2: æ˜¾ç¤ºCORSé”™è¯¯
**A:** 
1. ç¡®è®¤åç«¯å·²å¯åŠ¨
2. ç¡®è®¤åç«¯CORSé…ç½®åŒ…å«å‰ç«¯åœ°å€
3. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜

### Q3: ä»»ä½•å¯†ç éƒ½èƒ½ç™»å½•
**A:** 
1. æ£€æŸ¥å‰ç«¯ä»£ç æ˜¯å¦ä½¿ç”¨äº†æœ€æ–°ç‰ˆæœ¬
2. ç¡®è®¤æµè§ˆå™¨ç¼“å­˜å·²æ¸…é™¤
3. ç¡®è®¤æ²¡æœ‰ä½¿ç”¨Mockæ¨¡å¼

### Q4: Tokenæ— æ•ˆ
**A:**
1. æ£€æŸ¥JWTé…ç½®
2. ç¡®è®¤åç«¯å·²ä¿®å¤JWT identityç±»å‹é—®é¢˜
3. é‡æ–°ç™»å½•è·å–æ–°token

## âœ… éªŒæ”¶æ ‡å‡†

- âœ… æ­£ç¡®çš„ç”¨æˆ·åå¯†ç èƒ½æˆåŠŸç™»å½•
- âœ… é”™è¯¯çš„ç”¨æˆ·åå¯†ç ä¼šæç¤ºé”™è¯¯
- âœ… ç™»å½•åèƒ½æ­£å¸¸è®¿é—®å…¶ä»–é¡µé¢
- âœ… Tokenä¼šä¿å­˜åˆ°localStorage
- âœ… åˆ·æ–°é¡µé¢åç™»å½•çŠ¶æ€ä¿æŒ
- âœ… Networké¢æ¿æ˜¾ç¤ºçœŸå®çš„APIè¯·æ±‚
- âœ… ç™»å‡ºåæ¸…é™¤tokenå’Œç”¨æˆ·ä¿¡æ¯

---

**å½“å‰çŠ¶æ€ï¼šâœ… ç™»å½•åŠŸèƒ½å·²ä¿®å¤ï¼Œè¿æ¥çœŸå®åç«¯ï¼**

